title: "T-BC Log Analysis"
xaxis_label: "Time (seconds from start)"
yaxis_label: "Value"
width: 16
height: 10
dpi: 100

patterns:
  # E830 offset series
  - name: "E830 offset (ptp4l in free-running mode)"
    regex: 'E830 ptp4l\[.*\]: master offset\s+(-?\d+)\s+s\d+\s+freq'
    tag_filter: "e830"
    value_group: 1
    color: "blue"
    marker: "."
    line_style: "-"
    yaxis_label: "Offset (ns)"
    yaxis_index: 0

  # # E830 delay series
  # - name: "E830 delay"
  #   regex: 'E830 ptp4l\[.*\]: master offset\s+-?\d+\s+s\d+\s+freq\s+[+-]\d+\s+path delay\s+(\d+)'
  #   tag_filter: "e830"
  #   value_group: 1
  #   color: "green"
  #   marker: "."
  #   line_style: "-"
  #   yaxis_label: "Path Delay (ns)"
  #   yaxis_index: 0

  # E825 offset series
  - name: "E825 offset (ptp4l in free-running mode)"
    regex: 'E825 ptp4l\[.*\]: master offset\s+(-?\d+)\s+s\d+\s+freq'
    tag_filter: "e825"
    value_group: 1
    color: "red"
    marker: "."
    line_style: "-"
    yaxis_label: "Offset (ns)"
    yaxis_index: 0

  # # E825 delay series
  # - name: "E825 delay"
  #   regex: 'E825-NAC ptp4l\[.*\]: master offset\s+-?\d+\s+s\d+\s+freq\s+[+-]\d+\s+path delay\s+(\d+)'
  #   tag_filter: "e825"
  #   value_group: 1
  #   color: "orange"
  #   marker: "."
  #   line_style: "-"
  #   yaxis_label: "Path Delay (ns)"
  #   yaxis_index: 0

  # TR (daemon) offset series
  - name: "TR offset"
    regex: 'ptp4l\[.*\]: \[ptp4l\.\d+\.config:\d+\] master offset\s+(-?\d+)\s+s\d+\s+freq'
    tag_filter: "daemon"
    value_group: 1
    color: "purple"
    marker: "."
    line_style: "-"
    yaxis_label: "Offset (ns)"
    yaxis_index: 0

  # # TR path delay series
  # - name: "TR path delay"
  #   regex: 'ptp4l\[.*\]: \[ptp4l\.\d+\.config:\d+\] master offset\s+-?\d+\s+s\d+\s+freq\s+[+-]\d+\s+path delay\s+(\d+)'
  #   tag_filter: "daemon"
  #   value_group: 1
  #   color: "brown"
  #   marker: "."
  #   line_style: "-"
  #   yaxis_label: "Path Delay (ns)"
  #   yaxis_index: 0

  # TR state series (map state strings to numeric values)
  - name: "TR state"
    regex: 'ptp4l\[.*\]: \[ptp4l\.\d+\.config:\d+\] master offset\s+-?\d+\s+(s\d+)\s+freq'
    tag_filter: "daemon"
    value_group: 1
    state_group: 1
    state_mapping:
      s0: 10
      s1: 20
      s2: 30
      s3: 40
    color: "red"
    marker: "o"
    line_style: "-"
    yaxis_label: "State"
    yaxis_index: 0

  # eno5 DPLL lockStatus series (extract from JSON and map states)
  - name: "eno5 DPLL lockStatus"
    regex: '"lockStatus":"([^"]+)"[^}]*\}\s+(eno\d+)'
    tag_filter: "daemon"
    value_group: 1
    state_group: 1
    state_mapping:
      unlocked: 12
      locked: 22
      "locked-ho-acquired": 42
      holdover: 2
    color: "black"
    marker: "."
    line_style: "-"
    step: true
    yaxis_label: "Lock Status"
    yaxis_index: 0

  # T-BC state series
  - name: "T-BC state"
    regex: 'T-BC\[.*\]:\[ts2phc\.\d+\.config\]\s+\w+\s+offset\s+\d+\s+T-BC-STATUS\s+(s[0-2])'
    tag_filter: "daemon"
    value_group: 1
    state_group: 1
    state_mapping:
      s0: 14
      s1: 24
      s2: 34
    color: "magenta"
    marker: "d"
    line_style: "-"
    yaxis_label: "T-BC State"
    yaxis_index: 0

  # eno5 DPLL phase offset series
  - name: "eno5 DPLL offset"
    regex: 'dpll\.go:\d+\]\s+setting phase offset to\s+(-?\d+)\s+ns for clock id\s+\d+\s+iface\s+(eno\d+)'
    tag_filter: "daemon"
    value_group: 1
    color: "teal"
    marker: "."
    line_style: "-"
    yaxis_label: "DPLL Offset (ns)"
    yaxis_index: 0
